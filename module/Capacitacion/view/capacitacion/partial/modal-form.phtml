<?php
// expects: $title, $form, $submitText
$form->prepare();
?>
<div class="modal-header">
  <h5 class="modal-title"><?= $this->escapeHtml($title ?? 'Editar') ?></h5>
</div>
<div class="modal-body">
  <?php if (isset($currentImage) && !empty($currentImage)): ?>
    <div class="mb-3">
      <div class="text-muted small mb-1">Imagen actual</div>
      <img class="img-fluid" style="max-width:420px;border-radius:10px;" src="/<?= $this->escapeHtml($currentImage) ?>">
    </div>
  <?php endif; ?>

  <div class="alert alert-danger d-none js-modal-error"></div>

  <?= $this->form()->openTag($form->setAttribute('class','js-ajax-form')) ?>
  <?php foreach ($form->getElements() as $el):
    $name = $el->getName();
    if (in_array($name, ['submit'], true)) continue;
    // hidden fields
    if ($el instanceof \Laminas\Form\Element\Hidden): ?>
      <?= $this->formHidden($el) ?>
    <?php continue; endif; ?>

    <?php if ($el instanceof \Laminas\Form\Element\Checkbox): ?>
      <div class="custom-control custom-switch mb-3">
        <?= $this->formElement($el->setAttribute('id', 'm_' . $name)) ?>
        <label class="custom-control-label" for="<?= 'm_' . $name ?>"><?= $this->escapeHtml($el->getLabel() ?: $name) ?></label>
      </div>
    <?php elseif ($el instanceof \Laminas\Form\Element\File): ?>
      <div class="form-group">
        <label><?= $this->escapeHtml($el->getLabel() ?: 'Archivo') ?></label>
        <div class="custom-file">
          <?= $this->formElement($el->setAttribute('id','m_file_' . $name)) ?>
          <label class="custom-file-label" for="<?= 'm_file_' . $name ?>">Selecciona archivo…</label>
        </div>
        <small class="form-text text-muted">Máx 2MB</small>
        <div class="mt-2 d-none js-file-preview">
          <div class="text-muted small mb-1">Preview</div>
          <img style="max-width:420px;border-radius:10px;" class="img-fluid js-file-preview-img">
        </div>
      </div>
    <?php elseif ($el instanceof \Laminas\Form\Element\Select): ?>
      <div class="form-group">
        <label><?= $this->escapeHtml($el->getLabel() ?: $name) ?></label>
        <?= $this->formSelect($el) ?>
      </div>
    <?php else: ?>
      <div class="form-group">
        <label><?= $this->escapeHtml($el->getLabel() ?: $name) ?></label>
        <?= $this->formElement($el) ?>
      </div>
    <?php endif; ?>
  <?php endforeach; ?>

  <button type="submit" class="btn btn-primary"><?= $this->escapeHtml($submitText ?? 'Guardar') ?></button>
  <?= $this->form()->closeTag() ?>
</div>
