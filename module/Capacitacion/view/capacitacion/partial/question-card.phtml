<?php
// expects: $q, $capId, $answers
$qid = (int)($q['id'] ?? 0);
$alist = $answers[$qid] ?? [];
?>
<div class="card mb-2 js-question-card" data-question-id="<?= $qid ?>">
  <div class="card-header py-2 d-flex justify-content-between align-items-center">
    <button class="btn btn-link p-0 text-left" type="button" data-toggle="collapse" data-target="#c<?= $qid ?>">
      <b>#<?= $qid ?></b> Â· <?= $this->escapeHtml(mb_strimwidth((string)$q['question_text'], 0, 120, '...')) ?>
      <span class="badge badge-secondary ml-2"><?= $this->escapeHtml($q['type'] ?? '') ?></span>
    </button>
    <div class="btn-group btn-group-sm">
      <button class="btn btn-outline-primary js-edit-question" data-url="<?= $this->url('capacitacion-admin/question', ['action'=>'edit','id'=>$qid]) ?>?ajax=1&cap_id=<?= (int)$capId ?>">Editar</button>
      <button class="btn btn-outline-danger js-del-question" data-url="<?= $this->url('capacitacion-admin/question', ['action'=>'delete','id'=>$qid]) ?>" data-cap-id="<?= (int)$capId ?>">Borrar</button>
    </div>
  </div>

  <div id="c<?= $qid ?>" class="collapse">
    <div class="card-body">
      <?php if (!empty($q['image'])): ?>
        <div class="mb-3">
          <img src="https://test.ganamasconnwl.com/<?= $this->escapeHtml($q['image']) ?>" style="max-width: 420px; border-radius: 10px;" class="img-fluid">
        </div>
      <?php endif; ?>

      <div class="d-flex mb-3">
        <button class="btn btn-sm btn-success js-add-answer ml-auto"
          data-url="<?= $this->url('capacitacion-admin/answer', ['action'=>'add']) ?>?ajax=1&cap_id=<?= (int)$capId ?>&question_id=<?= $qid ?>&cap_id=<?= (int)$capId ?>">
          + Respuesta
        </button>
      </div>

      <div class="js-answers-wrap" data-question-id="<?= $qid ?>">
        RESPUESTAS
        <?= $this->partial('capacitacion/partial/answers-list', ['alist'=>$alist, 'qid'=>$qid]) ?>
      </div>

      <small class="text-muted d-block mt-2">Si el tipo es <b>radio</b>, solo 1 puede ser correcta.</small>
    </div>
  </div>
</div>
